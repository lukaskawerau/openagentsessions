{
	servers {
		protocols h1 h2
	}
	http_port 0
}

www.openagentsessions.org {
	tls internal
	redir https://openagentsessions.org{uri} permanent
}

openagentsessions.org {
	tls internal
	encode zstd gzip

	log {
		output file /var/log/caddy/openagentsessions.access.log {
			roll_size 25MiB
			roll_keep 10
			roll_keep_for 720h
		}
		format json
	}

	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "camera=(), microphone=(), geolocation=()"
		-Server
	}

	@nextStatic path /_next/static/*
	header @nextStatic Cache-Control "public, max-age=31536000, immutable"

	reverse_proxy app:3000 {
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
		header_up X-Real-IP {header.CF-Connecting-IP}
		header_up X-Forwarded-For {header.CF-Connecting-IP}
	}
}
